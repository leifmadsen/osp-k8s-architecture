---
## Component metallb replacement requirements

Each component expects a set of ConfigMap parameters to be passed to it so that
manifests can be generated by kustomize.

The component expects the parameters to be set in a corresponding local
ConfigMap in the overlay. Defaults are generally not provided by the component,
and errors will be thrown if the expected parameter is missing when building
the manifests with kustomize.

| ConfigMap source name | Parameter field path |
| ----------- | ---------- |
| network-values | data.ctlplane.lb_addresses |
| network-values | data.internalapi.lb_addresses |
| network-values | data.storage.lb_addresses |
| network-values | data.tenant.lb_addresses |
| network-values | data.ctlplane.lb_addresses |
| network-values | data.internalapi.lb_addresses |
| network-values | data.tenant.lb_addresses |
| network-values | data.ctlplane.lb_addresses |
| network-values | data.storage.lb_addresses |
| network-values | data.bridgeName |
| network-values | data.tenant.iface |
| network-values | data.storage.iface |
| network-values | data.internalapi.iface |

### Creating the local ConfigMap file

In the overlay, create a file that will hold the parameters for the component which will be later included as a resource within the `kustomization.yaml` file. The resource name may match the ConfigMap source name with `.yaml` appended or another filename such as `values.yaml`.

```yaml
# local-config: referenced, but not emitted by kustomize
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: <source_name>
  annotations:
    config.kubernetes.io/local-config: "true"
data:
    bridgeName: {}
    ctlplane:
        endpoint_annotations: {}
        iface: {}
        lb_addresses: {}
        mtu: {}
        prefix-length: {}
    dns-resolver:
        config: {}
        options: {}
    internalapi:
        base_iface: {}
        endpoint_annotations: {}
        iface: {}
        lb_addresses: {}
        mtu: {}
        prefix-length: {}
        vlan: {}
    lbServiceType: {}
    node_0:
        ctlplane_ip: {}
        internalapi_ip: {}
        name: {}
        storage_ip: {}
        tenant_ip: {}
    node_1:
        ctlplane_ip: {}
        internalapi_ip: {}
        name: {}
        storage_ip: {}
        tenant_ip: {}
    node_2:
        ctlplane_ip: {}
        internalapi_ip: {}
        name: {}
        storage_ip: {}
        tenant_ip: {}
    nodeset:
        ansible: {}
        networks: {}
        nodes: {}
        services: {}
    nova:
        migration:
            ssh_keys:
                private: {}
                public: {}
    openstack-operator-image: {}
    rabbitmq:
        endpoint_annotations: {}
    rabbitmq-cell1:
        endpoint_annotations: {}
    routes: {}
    ssh_keys:
        authorized: {}
        private: {}
        public: {}
    storage:
        base_iface: {}
        iface: {}
        lb_addresses: {}
        mtu: {}
        prefix-length: {}
        vlan: {}
    storageClass: {}
    tenant:
        base_iface: {}
        iface: {}
        lb_addresses: {}
        mtu: {}
        prefix-length: {}
        vlan: {}

```
